<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo Pro - Analytics Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-clipboard-list"></i>
                <span>ToDo Pro</span>
            </div>
            <ul class="nav-menu">
                <li><a href="cover.html" class="nav-link home-link" title="Back to Landing Page"><i class="fas fa-arrow-left"></i> Home</a></li>
                <li><a href="dashboard.html" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="tasks.html" class="nav-link"><i class="fas fa-tasks"></i> Tasks</a></li>
                <li><a href="analytics.html" class="nav-link active"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                <li><a href="ai-assistant.html" class="nav-link"><i class="fas fa-robot"></i> AI Assistant</a></li>
                <li><a href="settings.html" class="nav-link"><i class="fas fa-cog"></i> Settings</a></li>
                <li class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle"><i class="fas fa-ellipsis-v"></i> More</a>
                    <ul class="dropdown-menu">
                        <li><a href="cover.html"><i class="fas fa-info-circle"></i> Project Info</a></li>
                        <li><a href="cover.html"><i class="fas fa-home"></i> Landing Page</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a href="#" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> Exit App</a></li>
                    </ul>
                </li>
            </ul>
            <div class="nav-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <!-- Analytics Header -->
        <header class="analytics-header">
            <div class="header-content">
                <div class="welcome-section">
                    <h1><i class="fas fa-chart-line"></i> Productivity Analytics</h1>
                    <p class="header-subtitle">Deep insights into your productivity patterns and achievements</p>
                </div>
                <div class="header-actions">
                    <button id="darkModeToggle" class="theme-btn" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="time-period-selector">
                        <select id="timePeriod" class="modern-select">
                            <option value="week">üìÖ This Week</option>
                            <option value="month">üìÜ This Month</option>
                            <option value="quarter">üìä This Quarter</option>
                            <option value="year">üóìÔ∏è This Year</option>
                        </select>
                    </div>
                    <div class="analytics-badge">
                        <i class="fas fa-trophy"></i>
                        <span>Analytics Pro</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Analytics Dashboard Grid -->
        <div class="analytics-grid">
            <!-- Key Metrics Overview -->
            <div class="analytics-card metrics-overview-card">
                <div class="card-header">
                    <h3><i class="fas fa-dashboard"></i> Performance Overview</h3>
                    <p class="card-description">Your productivity metrics at a glance</p>
                </div>
                <div class="metrics-grid">
                    <div class="metric-item completed-metric">
                        <div class="metric-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="totalCompleted">0</div>
                            <div class="metric-label">Tasks Completed</div>
                            <div class="metric-trend">
                                <i class="fas fa-arrow-up"></i> +12% this week
                            </div>
                        </div>
                    </div>
                    <div class="metric-item time-metric">
                        <div class="metric-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="avgCompletionTime">2.5h</div>
                            <div class="metric-label">Avg. Completion</div>
                            <div class="metric-trend">
                                <i class="fas fa-arrow-down"></i> -15min faster
                            </div>
                        </div>
                    </div>
                    <div class="metric-item streak-metric">
                        <div class="metric-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="currentStreak">7</div>
                            <div class="metric-label">Day Streak</div>
                            <div class="metric-trend">
                                <i class="fas fa-arrow-up"></i> Personal best!
                            </div>
                        </div>
                    </div>
                    <div class="metric-item productivity-metric">
                        <div class="metric-icon">
                            <i class="fas fa-target"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-number" id="productivityRate">89%</div>
                            <div class="metric-label">Productivity Rate</div>
                            <div class="metric-trend">
                                <i class="fas fa-arrow-up"></i> Excellent!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="analytics-card chart-card task-distribution-card">
                <div class="card-header">
                    <h3><i class="fas fa-pie-chart"></i> Task Distribution</h3>
                    <p class="card-description">Breakdown of your task completion status</p>
                </div>
                <div class="chart-container">
                    <canvas id="taskDistributionChart"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item completed">
                        <div class="legend-color"></div>
                        <span>Completed</span>
                    </div>
                    <div class="legend-item pending">
                        <div class="legend-color"></div>
                        <span>Pending</span>
                    </div>
                    <div class="legend-item overdue">
                        <div class="legend-color"></div>
                        <span>Overdue</span>
                    </div>
                </div>
            </div>

            <div class="analytics-card chart-card weekly-progress-card">
                <div class="card-header">
                    <h3><i class="fas fa-line-chart"></i> Weekly Progress</h3>
                    <p class="card-description">Your productivity trend over the past 7 days</p>
                </div>
                <div class="chart-container">
                    <canvas id="weeklyProgressChart"></canvas>
                </div>
                <div class="progress-stats">
                    <div class="progress-stat">
                        <span class="stat-label">Best Day:</span>
                        <span class="stat-value" id="bestProgressDay">Wednesday</span>
                    </div>
                    <div class="progress-stat">
                        <span class="stat-label">Total Completed:</span>
                        <span class="stat-value" id="weeklyTotal">23 tasks</span>
                    </div>
                </div>
            </div>

            <div class="analytics-card chart-card category-breakdown-card">
                <div class="card-header">
                    <h3><i class="fas fa-bar-chart"></i> Category Analysis</h3>
                    <p class="card-description">Task distribution across different categories</p>
                </div>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="category-insights">
                    <div class="category-insight">
                        <div class="insight-icon work">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="insight-content">
                            <span class="insight-title">Work Tasks</span>
                            <span class="insight-percentage">45%</span>
                        </div>
                    </div>
                    <div class="category-insight">
                        <div class="insight-icon personal">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="insight-content">
                            <span class="insight-title">Personal</span>
                            <span class="insight-percentage">30%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="analytics-card chart-card daily-activity-card">
                <div class="card-header">
                    <h3><i class="fas fa-calendar-alt"></i> Daily Activity Heatmap</h3>
                    <p class="card-description">When you're most productive throughout the day</p>
                </div>
                <div class="chart-container">
                    <canvas id="dailyActivityChart"></canvas>
                </div>
                <div class="activity-summary">
                    <div class="activity-insight">
                        <i class="fas fa-sun"></i>
                        <span>Peak hours: 9AM - 11AM</span>
                    </div>
                    <div class="activity-insight">
                        <i class="fas fa-moon"></i>
                        <span>Low activity: 2PM - 4PM</span>
                    </div>
                </div>
            </div>

            <!-- Achievements Section -->
            <div class="analytics-card achievements-card">
                <div class="card-header">
                    <h3><i class="fas fa-trophy"></i> Achievement Gallery</h3>
                    <p class="card-description">Celebrate your productivity milestones</p>
                </div>
                <div class="achievements-grid" id="achievementsGrid">
                    <div class="achievement-item unlocked">
                        <div class="achievement-icon">
                            <i class="fas fa-medal"></i>
                        </div>
                        <div class="achievement-content">
                            <h4>First Steps</h4>
                            <p>Complete your first task</p>
                            <div class="achievement-badge">Unlocked</div>
                        </div>
                    </div>
                    <div class="achievement-item unlocked">
                        <div class="achievement-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="achievement-content">
                            <h4>Week Warrior</h4>
                            <p>7-day completion streak</p>
                            <div class="achievement-badge">Unlocked</div>
                        </div>
                    </div>
                    <div class="achievement-item locked">
                        <div class="achievement-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="achievement-content">
                            <h4>Productivity King</h4>
                            <p>Complete 100 tasks</p>
                            <div class="achievement-badge">85/100</div>
                        </div>
                    </div>
                    <div class="achievement-item locked">
                        <div class="achievement-icon">
                            <i class="fas fa-lightning-bolt"></i>
                        </div>
                        <div class="achievement-content">
                            <h4>Speed Demon</h4>
                            <p>Complete 10 tasks in one day</p>
                            <div class="achievement-badge">7/10</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Insights -->
            <div class="analytics-card insights-card">
                <div class="card-header">
                    <h3><i class="fas fa-lightbulb"></i> Smart Insights</h3>
                    <p class="card-description">AI-powered analysis of your productivity patterns</p>
                </div>
                <div class="insights-grid">
                    <div class="insight-item performance-insight">
                        <div class="insight-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="insight-content">
                            <h4>üìà Best Performing Day</h4>
                            <div class="insight-value" id="bestDay">Wednesday</div>
                            <div class="insight-description">Most tasks completed on this day</div>
                        </div>
                    </div>
                    <div class="insight-item time-insight">
                        <div class="insight-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="insight-content">
                            <h4>‚è∞ Peak Productivity Hours</h4>
                            <div class="insight-value" id="peakHours">9:00 AM - 11:00 AM</div>
                            <div class="insight-description">You're most productive during these hours</div>
                        </div>
                    </div>
                    <div class="insight-item category-insight">
                        <div class="insight-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="insight-content">
                            <h4>üìã Most Active Category</h4>
                            <div class="insight-value" id="topCategory">Work</div>
                            <div class="insight-description">Primary focus area for your tasks</div>
                        </div>
                    </div>
                    <div class="insight-item completion-insight">
                        <div class="insight-icon">
                            <i class="fas fa-target"></i>
                        </div>
                        <div class="insight-content">
                            <h4>üéØ Success Rate</h4>
                            <div class="insight-value" id="completionRate">89%</div>
                            <div class="insight-description">Tasks completed vs created</div>
                        </div>
                    </div>
                </div>
                <div class="insights-footer">
                    <a href="ai-assistant.html" class="insights-link">
                        <span>Get personalized recommendations</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Navigation Buttons -->
    <div class="floating-nav">
        <button class="floating-btn back-btn" onclick="goHome()" title="Back to Home">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button class="floating-btn info-btn" onclick="showProjectInfo()" title="Project Info">
            <i class="fas fa-info-circle"></i>
        </button>
    </div>

    <script>
        function goHome() { if (confirm('üè† Go back to the landing page?')) window.location.href = 'index.html'; }
        function showProjectInfo() { window.location.href = 'cover.html'; }
        function confirmLogout() { if (confirm('üö™ Exit application?')) { localStorage.setItem('lastVisited', 'analytics'); window.location.href = 'index.html'; }}
        document.addEventListener('DOMContentLoaded', function() {
            const dropdown = document.querySelector('.nav-dropdown');
            if (dropdown) {
                dropdown.querySelector('.dropdown-toggle').addEventListener('click', function(e) { e.preventDefault(); dropdown.classList.toggle('active'); });
                document.addEventListener('click', function(e) { if (!dropdown.contains(e.target)) dropdown.classList.remove('active'); });
                document.addEventListener('keydown', function(e) { if (e.key === 'Escape') dropdown.classList.remove('active'); });
            }
        });
    </script>

    <script>
        // Force create charts with guaranteed data - embedded solution
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Analytics page loaded with embedded charts');
            
            // Create guaranteed sample data
            const sampleTasks = [
                { id: '1', text: "Complete dashboard design", completed: true, date: "2025-08-06", category: "work", priority: "high" },
                { id: '2', text: "Review code changes", completed: true, date: "2025-08-05", category: "work", priority: "medium" },
                { id: '3', text: "Buy groceries", completed: false, date: "2025-08-07", category: "personal", priority: "low" },
                { id: '4', text: "Team meeting", completed: false, date: "2025-08-04", category: "work", priority: "urgent" },
                { id: '5', text: "Exercise routine", completed: true, date: "2025-08-06", category: "personal", priority: "medium" },
                { id: '6', text: "Project planning", completed: false, date: "2025-08-03", category: "work", priority: "high" }
            ];
            
            console.log('üìä Sample data created:', sampleTasks.length, 'tasks');
            
            // Save to localStorage
            localStorage.setItem('todoApp_tasks', JSON.stringify(sampleTasks));
            
            // Wait for Chart.js to be ready
            setTimeout(function() {
                if (typeof Chart === 'undefined') {
                    console.error('‚ùå Chart.js not loaded');
                    return;
                }
                
                console.log('‚úÖ Chart.js is ready, creating charts...');
                createAllCharts(sampleTasks);
            }, 1000);
        });
        
        function createAllCharts(tasks) {
            // Task Distribution Chart
            const taskCtx = document.getElementById('taskDistributionChart');
            if (taskCtx) {
                const completed = tasks.filter(t => t.completed).length;
                const today = '2025-08-07';
                const overdue = tasks.filter(t => !t.completed && t.date < today).length;
                const pending = tasks.filter(t => !t.completed && t.date >= today).length;
                
                console.log('üìä Task Distribution:', {completed, pending, overdue});
                
                new Chart(taskCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'Pending', 'Overdue'],
                        datasets: [{
                            data: [completed, pending, overdue],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 20, usePointStyle: true }
                            }
                        }
                    }
                });
                console.log('‚úÖ Task Distribution Chart created');
            }
            
            // Weekly Progress Chart
            const weeklyCtx = document.getElementById('weeklyProgressChart');
            if (weeklyCtx) {
                new Chart(weeklyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Tasks Completed',
                            data: [2, 1, 3, 1, 2, 1, 0],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#007bff',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, ticks: { stepSize: 1 } },
                            x: { grid: { display: false } }
                        }
                    }
                });
                console.log('‚úÖ Weekly Progress Chart created');
            }
            
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                const categories = {};
                tasks.forEach(task => {
                    categories[task.category] = (categories[task.category] || 0) + 1;
                });
                
                const labels = Object.keys(categories);
                const data = Object.values(categories);
                const colors = ['#007bff', '#28a745', '#ffc107', '#dc3545'];
                
                console.log('üìä Category data:', categories);
                
                new Chart(categoryCtx, {
                    type: 'bar',
                    data: {
                        labels: labels.map(cat => cat.charAt(0).toUpperCase() + cat.slice(1)),
                        datasets: [{
                            label: 'Tasks by Category',
                            data: data,
                            backgroundColor: colors.slice(0, labels.length),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, ticks: { stepSize: 1 } }
                        }
                    }
                });
                console.log('‚úÖ Category Chart created');
            }
            
            // Daily Activity Chart (Heatmap-style)
            const dailyCtx = document.getElementById('dailyActivityChart');
            if (dailyCtx) {
                // Create heatmap-style data for hours of the day
                const hours = [];
                const activityData = [];
                
                // Generate 24-hour data
                for (let i = 0; i < 24; i++) {
                    hours.push(i + ':00');
                    // Simulate activity levels (0-5 scale)
                    let activity = 0;
                    if (i >= 9 && i <= 11) activity = 4; // Peak morning
                    else if (i >= 14 && i <= 16) activity = 3; // Afternoon
                    else if (i >= 19 && i <= 21) activity = 2; // Evening
                    else if (i >= 7 && i <= 8) activity = 1; // Early morning
                    activityData.push(activity);
                }
                
                console.log('üìä Daily Activity data:', {hours: hours.slice(0,5), activity: activityData.slice(0,5)});
                
                new Chart(dailyCtx, {
                    type: 'bar',
                    data: {
                        labels: hours,
                        datasets: [{
                            label: 'Activity Level',
                            data: activityData,
                            backgroundColor: activityData.map(val => {
                                if (val >= 4) return '#dc3545'; // High activity - red
                                if (val >= 3) return '#fd7e14'; // Medium-high - orange  
                                if (val >= 2) return '#ffc107'; // Medium - yellow
                                if (val >= 1) return '#28a745'; // Low - green
                                return '#e9ecef'; // No activity - light gray
                            }),
                            borderWidth: 0,
                            borderRadius: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const levels = ['No Activity', 'Low', 'Medium', 'High', 'Peak'];
                                        return levels[context.parsed.y] || 'No Activity';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                max: 5,
                                ticks: { 
                                    stepSize: 1,
                                    callback: function(value) {
                                        const levels = ['None', 'Low', 'Med', 'High', 'Peak'];
                                        return levels[value] || '';
                                    }
                                }
                            },
                            x: { 
                                ticks: {
                                    maxTicksLimit: 12,
                                    callback: function(value, index) {
                                        return index % 2 === 0 ? this.getLabelForValue(value) : '';
                                    }
                                }
                            }
                        }
                    }
                });
                console.log('‚úÖ Daily Activity Chart created');
            }
            
            // Update stats
            updateStats(tasks);
            console.log('üéâ All charts and stats updated successfully!');
            console.log('üìä Charts created: Task Distribution, Weekly Progress, Category Analysis, Daily Activity');
        }
        
        function updateStats(tasks) {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;
            const completionRate = Math.round((completed / total) * 100);
            
            // Update metric cards
            const elements = {
                'totalCompleted': completed,
                'avgCompletionTime': '2h',
                'currentStreak': '3',
                'productivityRate': completionRate + '%'
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = value;
                    console.log('üìä Updated', id, ':', value);
                }
            });
        }
    </script>

    <script src="analytics.js"></script>
</body>
</html>
